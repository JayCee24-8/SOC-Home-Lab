# Safe Malware & Attack Simulation - SOC Home Lab

## Overview
This section of the SOC Home Lab focuses on simulating malware activity in a **controlled environment**.  
The goal is to generate realistic security events, capture them with **Sysmon**, and analyze them in **Splunk**.  

Two tests were performed:
1. **EICAR Test File** ‚Äì harmless antivirus test file to validate logging and detection.  
2. **Mimikatz** ‚Äì a post-exploitation tool used to extract credentials from memory.  

> ‚ö†Ô∏è All activities were executed in an **isolated lab** with snapshots to ensure safety.

---

## üß™ Test 1 ‚Äì EICAR File

### Steps
1. Configured the Windows machine on a NAT adapter and confirmed connectivity.  
2. Took a **baseline snapshot** before testing.  
3. Disabled **Windows Defender real-time protection** (otherwise, it deletes the file).  
4. Downloaded the **EICAR test file** from [eicar.org](https://www.eicar.org/download-anti-malware-testfile/).  
5. Saved it as `eicar.com`.  
6. Executed the file ‚Äì a Windows warning appeared (`This app can‚Äôt run on your PC`).  

### Splunk Analysis
- Queried Sysmon logs in Splunk:
  ```spl
  index=sysmon ("eicar.com" OR "eicar")
  | table _time EventCode User Image CommandLine ParentImage TargetFilename ProcessGuid
  | sort - _time```
- Events observed:
  - EventCode 11 (File Create) when saving eicar.com.
  - EventCode 1 (Process Create) when attempting to run the file.
### Takeaways:
- EICAR confirmed that the logging pipeline (Sysmon ‚Üí Splunk) works correctly.
- Even though the file doesn‚Äôt execute, attempts to save or run it are fully logged.

---

## Test 2 ‚Äì Mimikatz

### About
Mimikatz is a well-known post-exploitation tool that extracts credentials (passwords, hashes, Kerberos tickets) from LSASS (Local Security Authority Subsystem Service) memory.

### Steps:
- Disabled SmartScreen on Windows (otherwise, it blocks the download).
- Downloaded and extracted Mimikatz.
- Navigated to the x64 folder and launched mimikatz.exe as Administrator.
- Executed commands:
```
privilege::debug        # Grants SeDebugPrivilege (needed to access LSASS)
sekurlsa::logonpasswords  # Attempts to extract credentials from LSASS memory
exit
```
- Closed Mimikatz and reverted to snapshot after testing.

### Splunk Analysis
- Query used:
``` spl
index=sysmon Image="*mimikatz.exe"
| table _time EventCode User Image CommandLine ParentImage TargetImage ProcessGuid
| sort - _time
```
- Events observed:
  - EventCode 1 (Process Create) ‚Äì execution of mimikatz.exe.
  - EventCode 10 (Process Access) ‚Äì mimikatz.exe attempting to access lsass.exe.
  - ParentImage showed explorer.exe, meaning it was launched by double-click.

### Takeaways
- Mimikatz activity was successfully detected in Sysmon and visualized in Splunk.
- The test demonstrates how credential dumping attempts look in logs, helping build SOC detection playbooks.

---

## Lessons Learned
- Snapshots are critical before testing malware in a lab.
- Even simple tests like EICAR are useful to validate your logging pipeline.
- Tools like Mimikatz produce distinctive Sysmon events (Process Access to LSASS) that SOC analysts can hunt for.
- Building Splunk tables makes it easier to visualize attacker activity and document findings.
